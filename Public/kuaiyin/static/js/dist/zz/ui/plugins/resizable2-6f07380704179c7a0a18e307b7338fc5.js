define("zz/ui/plugins/resizable2",["./draggable2","zz/ui/plugins/state","jquery/jquery/1.7.2/jquery","zz/utils/objs","zz/utils/types","zz/utils/math","zz/ui/base/Effect","zz/core/Class","zz/utils/asserts"],function(a){"use strict";function b(a,b,c,d){d=d*Math.PI/180,a-=c[0],b-=c[1];var e=a*Math.cos(d)+b*Math.sin(d),f=-a*Math.sin(d)+b*Math.cos(d);return[e+c[0],f+c[1]]}function c(a,b,c,d){return[a+c/2,b+d/2]}function d(a,b){if(!b)return Math.round(a);a=Math.round(a);var c=a%b;return b/2>c?a-c:a-c+b}a("./draggable2");var e=(a("zz/utils/objs"),a("jquery/jquery/1.7.2/jquery")),f=a("zz/ui/base/Effect"),g=a("zz/core/Class"),h='<li class="ui-resizable-handler ui-resizable-{{handle}}" data-action="resize-{{handle}}"></li>',i=["ne","nw","se","sw","n","s","e","w"],j=g(f).attr({DEFAULT_OPTS:{handlers:i,ratio:!1,grid:0,startFn:e.noop,stepFn:e.noop,endFn:e.noop},TYPE:"resizable"}).method({bindEffect:function(){this.superClass.bindEffect.call(this);var a=this.$target,f=this._opts,g=this,h=20;a.addClass("ui-resizable"),this._addHandlers(),a.children(".ui-resizable-box").children().each(function(i,j){var k,l,m,n,o,p,j=e(j),q=j.attr("data-action").substr(7);j.draggable2({startFn:function(b){var c=a.offset();switch(this.$dragTarget.css({visibility:"hidden"}),q){case"ne":k=c.left,l=c.top+a.height();break;case"nw":k=c.left+a.width(),l=c.top+a.height();break;case"se":k=c.left,l=c.top;break;case"sw":k=c.left+a.width(),l=c.top;break;case"n":l=c.top+a.height();break;case"e":k=c.left;break;case"w":k=c.left+a.width();break;case"s":l=c.top}f.startFn&&f.startFn.call(g,b,f)},stepFn:function(e){e.isDrag=!1,e.isResize=!0,p=a.offset(),o=parseFloat(a.attr("data-rotate")||0);var i=c(p.left,p.top,a.width(),a.height()),j=b(e.pageX,e.pageY,i,o),r=d(j[0],f.grid),s=d(j[1],f.grid);switch(m=Math.abs(r-k)>h?Math.abs(r-k):h,n=Math.abs(s-l)>h?Math.abs(s-l):h,m=d(m,f.grid),n=d(n,f.grid),q){case"ne":l-h>s&&(a.offset({top:s}),a.height(n)),f.ratio?a.width(n*f.ratio):r>k+h&&a.width(m);break;case"nw":l-h>s&&(a.offset({top:s}),a.height(n)),f.ratio?(a.offset({left:k-n*f.ratio}),a.width(n*f.ratio)):k-h>r&&(a.offset({left:r}),a.width(m));break;case"se":s>l+h&&a.height(n),f.ratio?a.width(n*f.ratio):r>k+h&&a.width(m);break;case"sw":s>l+h&&a.height(n),f.ratio?(a.offset({left:k-n*f.ratio}),a.width(n*f.ratio)):k-h>r&&(a.offset({left:r}),a.width(m));break;case"n":l-h>s&&(a.offset({top:s}),a.height(n));break;case"e":r>k+h&&a.width(m);break;case"s":s>l+h&&a.height(n);break;case"w":k-h>r&&(a.offset({left:r}),a.width(m))}f.stepFn&&f.stepFn.call(g,e,f)},endFn:function(a){a.isDrag=!1,a.isResize=!0,f.endFn&&f.endFn.call(g,a,f)},dragTarget:"clone",cursor:q+"-resize",cursorAt:[7,7]})})},unBindEffect:function(){return this.superClass.unBindEffect.call(this),this.$target.removeClass("ui-resizable"),this.$target.find(".ui-resizable-box").remove(),this},updateOpts:function(a){this.superMethod("updateOpts",a),this._addHandlers()},_addHandlers:function(){var a=[],b=this.$target.children(".ui-resizable-box"),c=this._opts.handlers.slice();0==b.length&&(i.forEach(function(b){a.push(h.replace(/{{handle}}/g,b))}),this.$target.append('<ul class="ui-resizable-box">'+a.join("")+"</ul>"),b=this.$target.children(".ui-resizable-box")),b.children().each(function(){var a=e(this).attr("data-action").substr(7);e(this).css("visibility","visible"),-1===c.indexOf(a)&&e(this).css("visibility","hidden")})}});return e.fn.extend({resizable2:function(a){if(this.isState("resizable")){var b=this.data("resizableEffectObj");return b.updateOpts(a),this}var b=new j(this,a);return b.bindEffect(),this},unResizable2:function(){if(this.isState("resizable")){var a=this.data("resizableEffectObj");a.unBindEffect().destroy()}return this}}),j});