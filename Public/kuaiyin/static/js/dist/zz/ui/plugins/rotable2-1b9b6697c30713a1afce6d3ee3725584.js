define("zz/ui/plugins/rotable2",["jquery.transform","zz/ui/plugins/state","jquery/jquery/1.7.2/jquery","zz/utils/objs","zz/utils/types","zz/ui/base/Effect","zz/core/Class","zz/utils/asserts"],function(a){"use strict";function b(a,b,c,d,e,f){var g;return g=180*Math.atan2(f-b,e-a)/Math.PI-180*Math.atan2(d-b,c-a)/Math.PI,g=(g+360)%360,Math.round(g)}a("jquery.transform"),a("zz/ui/plugins/state");var c=(a("zz/utils/objs"),a("jquery/jquery/1.7.2/jquery")),d=a("zz/ui/base/Effect"),e=a("zz/core/Class"),f=e(d).attr({DEFAULT_OPTS:{startFn:c.noop,stepFn:c.noop,endFn:c.noop},TYPE:"rotable"}).method({bindEffect:function(){this.superClass.bindEffect.call(this);var a=this.$target,d=this._opts,e=this;a.addClass("ui-rotatable"),a.append('<div class="ui-rotable-box none"><div class="ui-rotable-handler" title="按住拖动旋转"></div><div class="ui-rotable-line"></div></div>');var f=a.find(".ui-rotable-handler");f.on("mousedown.rotate",function(f){var g,h,i,j,k,l,m,n;f.stopPropagation(),f.preventDefault(),i=f.pageX,j=f.pageY,m=parseInt(a.attr("data-rotate")||0),g=a.offset().left+a.width()/2,h=a.offset().top+a.height()/2,d.startFn&&d.startFn.call(e,f,d),c(document).on({"mousemove.rotate":function(c){k=c.pageX,l=c.pageY,n=m+b(g,h,i,j,k,l),n%=360,a.attr("data-rotate",n),a.transform({rotate:n+"deg"}),d.stepFn&&d.stepFn.call(e,c,d),c.preventDefault()},"mouseup.rotate":function(a){d.endFn&&d.endFn.call(e,a,d),c(document).off(".rotate"),a.preventDefault()}})})},unBindEffect:function(){return this.superClass.unBindEffect.call(this),this.$target.removeClass("ui-rotable"),this.$target.find(".ui-rotable-box").remove(),this}});return c.fn.extend({rotable2:function(a){if(this.isState("rotable")){var b=this.data("rotableEffectObj");return b.updateOpts(a),this}var b=new f(this,a);return b.bindEffect(),this},unRotable2:function(){if(this.isState("rotable")){var a=this.data("rotableEffectObj");a.unBindEffect().destroy()}return this}}),f});