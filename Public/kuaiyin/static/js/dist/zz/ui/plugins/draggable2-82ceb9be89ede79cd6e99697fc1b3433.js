define("zz/ui/plugins/draggable2",["zz/ui/plugins/state","jquery/jquery/1.7.2/jquery","zz/utils/objs","zz/utils/types","zz/utils/math","zz/ui/base/Effect","zz/core/Class","zz/utils/asserts"],function(a){"use strict";a("zz/ui/plugins/state");var b=a("jquery/jquery/1.7.2/jquery"),c=(a("zz/utils/objs"),a("zz/utils/types")),d=a("zz/utils/math"),e=a("zz/ui/base/Effect"),f=a("zz/core/Class"),g=f(e).attr({DEFAULT_OPTS:{appendTo:document.body,dragTarget:"self",cursor:"move",dragScopeX:[],dragScopeY:[],dragScope:"window",addTargetScope:!0,grid:0,cursorAt:null,snapLen:5,snapArr:null,snapAppendTo:document.body,startFn:b.noop,endFn:b.noop,stepFn:b.noop,noMoveX:!1,noMoveY:!1},TYPE:"draggable"}).init(function(a,b){this.superInit(a,b),this.$dragTarget=this.$target,this.originPosition=this.$dragTarget.position(),this.dragLen=[0,0]}).method({bindEffect:function(){this.superClass.bindEffect.call(this);var a=this.$target,c=this._opts,d=this;return a.addClass("ui-draggable"),a.on("http://www.mayicy.cn/Public/kuaiyin/static/js/dist/zz/ui/plugins/mousedown.drag",function(e,f){var g,h,i;switch(f&&(e.pageX=f.pageX,e.pageY=f.pageY),e.stopPropagation(),e.preventDefault(),c.dragTarget){case"self":d.$dragTarget=a;break;case"clone":d.$dragTarget=a.clone().prependTo(c.appendTo);break;default:d.$dragTarget=c.dragTarget}d.$dragTarget.css("cursor",c.cursor),b(document.body).css("cursor",c.cursor),i={left:a.offset().left,top:a.offset().top},g=e.pageX-i.left,h=e.pageY-i.top,c.cursorAt&&(g=c.cursorAt[0],h=c.cursorAt[1]),c.startFn&&c.startFn.call(d,e,c),b(document).on({"http://www.mayicy.cn/Public/kuaiyin/static/js/dist/zz/ui/plugins/mousemove.drag":function(a){d._setOffset(d.$dragTarget,a.pageX-g,a.pageY-h,c);var b=d.$dragTarget.offset();d.dragLen=[b.left-i.left,b.top-i.top],c.stepFn&&c.stepFn.call(d,a,c),a.preventDefault()},"http://www.mayicy.cn/Public/kuaiyin/static/js/dist/zz/ui/plugins/mouseup.drag":function(e){c.endFn&&c.endFn.call(d,e,c),b(document.body).css("cursor","auto"),b(document).off(".drag"),d.$dragTarget!==a&&(d.$dragTarget.remove(),d.$dragTarget=null),e.preventDefault()}})}),this},unBindEffect:function(){return this.superClass.unBindEffect.call(this),this.$target.removeClass("ui-draggable"),this.$target.off("http://www.mayicy.cn/Public/kuaiyin/static/js/dist/zz/ui/plugins/mousedown.drag"),b(document).css("cursor","auto"),this},_setOffset:function(a,e,f,g){var h,i,j,k,l,m=g.dragScope,n=g.addTargetScope,o=g.grid,p=parseFloat(a.attr("data-rotate")||0),q=d.getRotateRect(a.width(),a.height(),p),r=q[0],s=q[1];if("window"!=m?(h="parent"==m?a.parent():c.isObject(m)?m:b("#"+m),i=h.offset().left,j=h.offset().top,k=i+h.width()-r,l=j+h.height()-s):(i=0,j=0,k=b(window).width()-r,l=b(window).height()-s),n&&(i-=r,j-=s,k+=r,l+=s),g.snapArr){var t=parseInt(a.css("borderWidth")||0);e=this.getSnapNum(e+r+2*t,"x")-r-2*t,f=this.getSnapNum(f+s+2*t,"y")-s-2*t,e=this.getSnapNum(e,"x"),f=this.getSnapNum(f,"y")}var u=a.offsetParent().offset();0!==g.dragScopeX.length&&(i=u.left+this.originPosition.left+g.dragScopeX[0],k=u.left+this.originPosition.left+g.dragScopeX[1]),0!==g.dragScopeY.length&&(j=u.left+this.originPosition.top+g.dragScopeY[0],l=u.left+this.originPosition.top+g.dragScopeY[1]),e=e>i?e:i,f=f>j?f:j,e=k>e?e:k,f=l>f?f:l,g.noMoveX||a.offset({left:d.getGridNum(e,o)}),g.noMoveY||a.offset({top:d.getGridNum(f,o)})},getSnapNum:function(a,b){{var c,e=this._opts.snapArr[0],f=this._opts.snapLen;this._opts.dragScope}return"y"==b&&(e=this._opts.snapArr[1]),c=d.getSnapNum(a,e,f),c===a?a:(this.showSnapLine(this._opts.snapAppendTo,"y"===b?"x":"y",c),c)},showSnapLine:function(a,c,d){function e(){f.remove()}var f=b("<div class='ui-snap-line-"+c+"'></div>");f.appendTo(a),f.offset("x"==c?{top:d}:{left:d}),setTimeout(e,500)}});return b.fn.extend({draggable2:function(a){if(this.isState("draggable")){var b=this.data("draggableEffectObj");return b.updateOpts(a),this}var b=new g(this,a);return b.bindEffect(),this},unDraggable2:function(){if(this.isState("draggable")){var a=this.data("draggableEffectObj");a.unBindEffect().destroy()}return this},triggerDrag2:function(a){if(!this.isState("draggable"))throw new Error("未注册拖拽");return this.trigger("http://www.mayicy.cn/Public/kuaiyin/static/js/dist/zz/ui/plugins/mousedown.drag",a),this}}),g});