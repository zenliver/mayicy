define("zz/core/Class",["zz/utils/types","zz/utils/asserts","zz/utils/objs"],function(a){"use strict";function b(a){function e(){var a=this&&this.constructor;if(!(a&&this instanceof a))throw new Error('construct lose "new" !!');var b,c,d,e,f=a.__wrapers__||(a.__wrapers__=[]),g=this,h=[];if(!a.__orderCorrect__)throw new Error("父类接口["+a.getParent().__orders__+"]未实现完!!");if(this.init&&(e=this.init.apply(this,arguments)||this),0!==f.length){for(c=f.length-1;c>=0;c--)k(f[c],function(a,b){if("init"!==b){if(g[b])throw new Error("wrapers method conflict");g[b]=a}else h.push(a)});for(c=0,d=h.length;c!=d;c++)if(b=h[c].apply(this,arguments),void 0!==b&&b!==this)return b}return e||this}if(a||(a=b),i([a],["Function"]),a.__final)throw new Error("final 类不能被继承");return c(e,a),e.__orderCorrect__=a.__orders__&&0!==a.__orders__.length?!1:!0,d(e)}function c(a,b){var c,d=function(){};d.prototype=b.prototype,c=new d,c.constructor=a,c.superClass=b.prototype,a.prototype=c}function d(a){return g.extend(a,b),a}var e=a("zz/utils/types"),f=a("zz/utils/asserts"),g=a("zz/utils/objs"),h=e.isFunction,i=f.assertType,j=f.assert,k=g.forEach,l=/^[_A-Z]+$/,m="__STATE__",n=["superClass","constructor","getState","onState","unState","triggerState","superInit","superMethod","destroy","init","toggleMethod","getParent"],o=b.prototype;return o.getState=b.getState,o.onState=function(a,b,c){var d,e;return a=m+a,j(void 0!==this[a],"要监听的状态名"+a+"不存在!!"),a=this[a][0],d=this.__stateMap__||(this.__stateMap__={}),e=d[a]||(d[a]=[]),e.push([b,c||this]),this},o.onceState=function(a,b,c){var d=function(){b.apply(c||this,arguments),this.unState(a,d)};return this.onState(a,d,c),this},o.triggerState=function(a){var b,c=Array.prototype.slice.call(arguments,1);return a=m+a,this.__stateMap__&&(j(void 0!==this[a],"要监听的状态名"+a+"不存在!!"),a=this[a][0],b=this.__stateMap__[a]||[],b.forEach(function(a){a&&a[0].apply(a[1],c)})),this},o.unState=function(a){var b,c=arguments;return a=m+a,this.__stateMap__&&this[a]&&(a=this[a][0],b=this.__stateMap__[a]||[],c.length>1?b.forEach(function(a,d){for(var e=1,f=c.length;f>e;e++)a&&c[e]==a[0]&&(b[d]=void 0)}):this.__stateMap__[a]=[]),this},o.superInit=function(){return j(this.superClass.init,"父类没有构造函数init"),this.superClass.init.apply(this,arguments),this},o.superMethod=function(){var a=Array.prototype.shift.call(arguments);return j(this.superClass[a],"父类没有方法"+a),this.superClass[a].apply(this,arguments),this},o.destroy=function(){return g.forEach(this,function(a,b,c){c[b]=null}),this},b.extend=function(){return Array.prototype.unshift.call(arguments,this),g.extend.apply(this,arguments),this},b.init=function(a){return j(h(a),"构造函数错误或为空!!"),this.prototype.init=a,this},b.order=function(){for(var a=this.__orders__||(this.__orders__=[]),b=0,c=arguments.length;b!=c;b++)j(e.isString(arguments[b]),"接口必须是字符串!!"),a.push(arguments[b]);return this},b.wrap=function(){for(var a=this.__wrapers__||(this.__wrapers__=[]),b=0,c=arguments.length;b!=c;b++)a.push(arguments[b]);return this},b.unWrap=function(){var a=this.__wrapers__||(this.__wrapers__=[]);return 0!=a.length&&g.remove(a,arguments),this},b.defState=function(){for(var a,b=this.prototype,c=0,d=arguments.length;c!=d;c++)a=arguments[c],j(e.isString(a),"状态必须是字符串！！"),a=m+a,j(l.test(a),"状态名"+a+"只能是大写字母或下划线!!"),j(void 0===b[a],"状态"+a+"已经被定义了！！"),b[a]=[a];return this},b.aliasState=function(a,b){var c=this.prototype;return i(arguments,["String","String"]),a=m+a,b=m+b,j(l.test(a),"状态名"+a+"只能是大写字母或下划线!!"),j(void 0===c[a],"状态"+a+"已经被定义了！！"),j(void 0!==c[b],"要创建的别名状态"+b+"不存在!!"),c[a]=c[b],this},b.getState=function(a){var b,c=this.prototype||this;return a=m+a,j(void 0!==(b=c[a]),"状态名"+a+"未定义"),b},b.attr=function(a){var b=this.prototype;return k(a,function(a,c){if(h(a))throw new Error("属性"+c+"为函数!!");if(!l.test(c))throw new Error("属性名"+c+"不合法!!");b[c]=a}),this},b.method=function(a){var b=this.prototype,c=this,d=this.getParent().__orders__||[],e=this.__toggleOnceArr__||(this.__toggleOnceArr__=[]),f=this.getParent().__toggleOnceArr__||[],g=d.length;if(f=0!==f.length?f.concat():null,(0===g||this.hasOwnProperty("__orderCorrect__")&&this.__orderCorrect__===!0)&&(this.__orderCorrect__=!0),k(a,function(a,e){if(n.forEach(function(a){if(e===a)throw new Error("不能使用方法名: "+e)}),!c.__orderCorrect__)for(var i=0,j=d.length;i!=j;i++)d[i].trim()===e&&g--;if(!h(a))throw new Error("属性"+e+"为非函数!!");if(b[e]=a,f){var k,l,m=e;-1!==(k=f.indexOf(m))&&(k%3===0?(l=f[k+1],(null===l||b.hasOwnProperty(l)&&b[l])&&(c.toggleOnce(m,l,f[k+2]),f.splice(k,3))):(l=e,m=f[k-1],b.hasOwnProperty(m)&&b[m]&&(c.toggleOnce(m,l,f[k+1]),f.splice(k-1,3))))}}),0!==g)throw new Error("父类接口["+d+"]未实现完!!");if(this.__orderCorrect__=!0,f&&(e.forEach(function(a){var b;-1!==(b=e.indexOf(a))&&null!==a&&b%3==0&&f.splice(b,3)}),0!==f.length))throw new Error("父类toggleOnce需要方法: "+f);return this},b.toggleOnce=function(a,b,c){var d,f,g,h,i,k=this.prototype,l=-1,m=-1;if(d=this.__toggleOnceArr__||(this.__toggleOnceArr__=[]),j(k.hasOwnProperty(a),"类未实现"+a+"方法"),e.isFunction(b)&&(c=b,b=null),l=d.indexOf(a),b&&(m=d.indexOf(b)),-1!==l&&l%3!==0||!c&&(-1!==l||-1!==m))return this;if(l>m&&-1!==m)throw new Error(a+"和"+b+"倒置了!!");return f=k[a],h=function(){return this["__is_"+a]&&this[a]===h?(c&&c.call(this,!0),this):(f.apply(this,arguments),this["__is_"+a]=!0,this)},k[a]=h,b&&(j(k.hasOwnProperty(b),"类未实现"+b+"方法"),g=k[b],i=function(){return this["__is_"+a]||this[b]!==i?(g.apply(this,arguments),this["__is_"+a]=!1,this):(c&&c.call(this,!1),this)},k[b]=i),-1!==l&&l%3==0?d.splice(l,3,a,b,c):d.push(a,b,c),this},b.make=function(){return new this.apply(this,arguments)},b.final=function(){return this.__final=!0,this},b.getParent=function(){return this.prototype.superClass.constructor},b});